#!/bin/bash
# Pre-commit hook: ã‚³ãƒŸãƒƒãƒˆå‰ã«ktlintã¨detektã‚’å®Ÿè¡Œ

echo "ğŸ” Running code quality checks..."
echo ""

# ktlintã§è‡ªå‹•ãƒ•ã‚©ãƒ¼ãƒãƒƒãƒˆ
echo "ğŸ“ Running ktlint format..."
./gradlew ktlintFormat --daemon
KTLINT_FORMAT_RESULT=$?

if [ $KTLINT_FORMAT_RESULT -ne 0 ]; then
    echo ""
    echo "âŒ ktlint format failed"
    echo ""
    echo "ğŸ’¡ Fix suggestions:"
    echo "   1. Check the error and fix manually"
    echo "   2. Skip hook (not recommended):"
    echo "      git commit --no-verify"
    echo ""
    exit 1
fi

echo "âœ… ktlint format passed"
echo ""

# ktlintãƒã‚§ãƒƒã‚¯
echo "ğŸ“‹ Running ktlint check..."
./gradlew ktlintCheck --daemon
KTLINT_CHECK_RESULT=$?

if [ $KTLINT_CHECK_RESULT -ne 0 ]; then
    echo ""
    echo "âŒ ktlint check failed"
    echo ""
    echo "ğŸ’¡ Fix suggestions:"
    echo "   1. Run format again:"
    echo "      ./gradlew ktlintFormat"
    echo ""
    echo "   2. Check the report:"
    echo "      cat build/reports/ktlint/**/ktlint*.txt"
    echo ""
    exit 1
fi

echo "âœ… ktlint check passed"
echo ""

# detektã§é™çš„è§£æ
echo "ğŸ” Running detekt..."
./gradlew detekt --daemon
DETEKT_RESULT=$?

if [ $DETEKT_RESULT -ne 0 ]; then
    echo ""
    echo "âŒ detekt check failed"
    echo ""
    echo "ğŸ’¡ Fix suggestions:"
    echo "   1. View the HTML report:"
    echo "      open build/reports/detekt/detekt.html"
    echo ""
    echo "   2. Or view text report:"
    echo "      cat build/reports/detekt/detekt.txt"
    echo ""
    echo "   3. Fix the issues manually or suppress if needed"
    echo ""
    exit 1
fi

echo "âœ… detekt passed"
echo ""
echo "========================================="
echo "âœ… All checks passed! Proceeding with commit..."
echo "========================================="
exit 0
